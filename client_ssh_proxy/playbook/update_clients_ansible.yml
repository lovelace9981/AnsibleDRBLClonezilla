---
- hosts: nodes
  become: yes
  gather_facts: yes

  tasks:
    - name: Set authorized key taken from file
      ansible.posix.authorized_key:
        user: usuario
        state: present
        key: "{{ lookup('file', '~/.ssh/id_rsa.pub') }}"
    
    - name: apt update
      ansible.builtin.apt:
        update_cache: yes
        cache_valid_time: 3600

    - name: Upgrade the OS (apt dist-upgrade)
      ansible.builtin.apt:
        upgrade: dist
    
    - name: Instalando utilidades para incrementar el tamanio de las particiones.
      ansible.builtin.apt:
        name: cloud-guest-utils
        state: present
        update_cache: yes
    
    - name: Incrementando las particiones
      ansible.builtin.command: "sudo growpart /dev/sda 2 && sudo resize2fs /dev/sda2"

      


